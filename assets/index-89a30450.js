var Tt=Object.defineProperty;var jt=(e,s,o)=>s in e?Tt(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o;var dt=(e,s,o)=>(jt(e,typeof s!="symbol"?s+"":s,o),o);import{e as mt,r as T,m as gt,t as yt,c as O,i as tt,a as ct,b as At,d as Ht,w as et,f as It,h as Pt,g as Rt,o as Ot,n as Lt,j as Yt,k as R,l as it,p as q,q as st,s as h,u as m,v as n,x as ut,y as ft,F as B,z,A as at,B as I,C as J,D as H,E as Et,G as $,H as Q,I as Nt}from"./vendor-2f4991bf.js";import{C as pt,r as Ft}from"./chart-44191cde.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function o(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(t){if(t.ep)return;t.ep=!0;const r=o(t);fetch(t.href,r)}})();var Bt=!1;/*!
 * pinia v2.3.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let _t;const ot=e=>_t=e,bt=Symbol();function rt(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var X;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(X||(X={}));function zt(){const e=mt(!0),s=e.run(()=>T({}));let o=[],a=[];const t=gt({install(r){ot(t),t._a=r,r.provide(bt,t),r.config.globalProperties.$pinia=t,a.forEach(u=>o.push(u)),a=[]},use(r){return!this._a&&!Bt?a.push(r):o.push(r),this},_p:o,_a:null,_e:e,_s:new Map,state:s});return t}const xt=()=>{};function vt(e,s,o,a=xt){e.push(s);const t=()=>{const r=e.indexOf(s);r>-1&&(e.splice(r,1),a())};return!o&&Rt()&&Ot(t),t}function G(e,...s){e.slice().forEach(o=>{o(...s)})}const Ut=e=>e(),ht=Symbol(),nt=Symbol();function lt(e,s){e instanceof Map&&s instanceof Map?s.forEach((o,a)=>e.set(a,o)):e instanceof Set&&s instanceof Set&&s.forEach(e.add,e);for(const o in s){if(!s.hasOwnProperty(o))continue;const a=s[o],t=e[o];rt(t)&&rt(a)&&e.hasOwnProperty(o)&&!tt(a)&&!ct(a)?e[o]=lt(t,a):e[o]=a}return e}const Wt=Symbol();function Vt(e){return!rt(e)||!e.hasOwnProperty(Wt)}const{assign:F}=Object;function Gt(e){return!!(tt(e)&&e.effect)}function qt(e,s,o,a){const{state:t,actions:r,getters:u}=s,d=o.state.value[e];let f;function i(){d||(o.state.value[e]=t?t():{});const _=Yt(o.state.value[e]);return F(_,r,Object.keys(u||{}).reduce((D,b)=>(D[b]=gt(O(()=>{ot(o);const S=o._s.get(e);return u[b].call(S,S)})),D),{}))}return f=wt(e,i,s,o,a,!0),f}function wt(e,s,o={},a,t,r){let u;const d=F({actions:{}},o),f={deep:!0};let i,_,D=[],b=[],S;const p=a.state.value[e];!r&&!p&&(a.state.value[e]={}),T({});let g;function l(w){let c;i=_=!1,typeof w=="function"?(w(a.state.value[e]),c={type:X.patchFunction,storeId:e,events:S}):(lt(a.state.value[e],w),c={type:X.patchObject,payload:w,storeId:e,events:S});const v=g=Symbol();Lt().then(()=>{g===v&&(i=!0)}),_=!0,G(D,c,a.state.value[e])}const y=r?function(){const{state:c}=o,v=c?c():{};this.$patch(k=>{F(k,v)})}:xt;function x(){u.stop(),D=[],b=[],a._s.delete(e)}const Y=(w,c="")=>{if(ht in w)return w[nt]=c,w;const v=function(){ot(a);const k=Array.from(arguments),C=[],M=[];function W(P){C.push(P)}function V(P){M.push(P)}G(b,{args:k,name:v[nt],store:j,after:W,onError:V});let U;try{U=w.apply(this&&this.$id===e?this:j,k)}catch(P){throw G(M,P),P}return U instanceof Promise?U.then(P=>(G(C,P),P)).catch(P=>(G(M,P),Promise.reject(P))):(G(C,U),U)};return v[ht]=!0,v[nt]=c,v},N={_p:a,$id:e,$onAction:vt.bind(null,b),$patch:l,$reset:y,$subscribe(w,c={}){const v=vt(D,w,c.detached,()=>k()),k=u.run(()=>et(()=>a.state.value[e],C=>{(c.flush==="sync"?_:i)&&w({storeId:e,type:X.direct,events:S},C)},F({},f,c)));return v},$dispose:x},j=It(N);a._s.set(e,j);const A=(a._a&&a._a.runWithContext||Ut)(()=>a._e.run(()=>(u=mt()).run(()=>s({action:Y}))));for(const w in A){const c=A[w];if(tt(c)&&!Gt(c)||ct(c))r||(p&&Vt(c)&&(tt(c)?c.value=p[w]:lt(c,p[w])),a.state.value[e][w]=c);else if(typeof c=="function"){const v=Y(c,w);A[w]=v,d.actions[w]=c}}return F(j,A),F(yt(j),A),Object.defineProperty(j,"$state",{get:()=>a.state.value[e],set:w=>{l(c=>{F(c,w)})}}),a._p.forEach(w=>{F(j,u.run(()=>w({store:j,app:a._a,pinia:a,options:d})))}),p&&r&&o.hydrate&&o.hydrate(j.$state,p),i=!0,_=!0,j}/*! #__NO_SIDE_EFFECTS__ */function Kt(e,s,o){let a,t;const r=typeof s=="function";typeof e=="string"?(a=e,t=r?o:s):(t=e,a=e.id);function u(d,f){const i=Pt();return d=d||(i?Ht(bt,null):null),d&&ot(d),d=_t,d._s.has(a)||(r?wt(a,s,t,d):qt(a,t,d)),d._s.get(a)}return u.$id=a,u}function Qt(e){{const s=yt(e),o={};for(const a in s){const t=s[a];t.effect?o[a]=O({get:()=>e[a],set(r){e[a]=r}}):(tt(t)||ct(t))&&(o[a]=At(e,a))}return o}}const kt="https://your-domain.com/api";async function L(e,s={}){const a=new AbortController,t=setTimeout(()=>a.abort(),5e3);try{const r=`${kt}${e}`,u=await fetch(r,{headers:{"Content-Type":"application/json",...s.headers},signal:a.signal,...s});if(clearTimeout(t),!u.ok)throw new Error(`API 请求失败: ${u.status} ${u.statusText}`);const d=await u.json();if(!d.success)throw new Error(d.message||"API 返回错误");return d}catch(r){throw clearTimeout(t),r instanceof Error&&r.name==="AbortError"?new Error("API 请求超时 (5000ms)"):(console.error("❌ API 请求失败:",r),r)}}class Jt{constructor(s){dt(this,"baseUrl");this.baseUrl=s||kt}async storeDailyData(s,o){try{const a=`hamster:${s}`;await L(`/set/${encodeURIComponent(a)}`,{method:"POST",body:JSON.stringify({value:o.toString()})}),console.log(`✅ 已存储 ${s} 的运动数据: ${o} 圈 (后端 API)`)}catch(a){throw console.error("❌ 存储运动数据失败:",a),a}}async getDailyData(s){try{const o=`hamster:${s}`,t=(await L(`/get/${encodeURIComponent(o)}`)).data;return t?parseInt(t,10):null}catch(o){throw console.error("❌ 获取运动数据失败:",o),o}}async getDateRangeData(s,o){try{const t=(await L("/hamster/all")).data,r=new Map;for(const[u,d]of Object.entries(t))u>=s&&u<=o&&r.set(u,d);return r}catch(a){throw console.error("❌ 获取日期范围数据失败:",a),a}}async getAllData(){try{const o=(await L("/hamster/all")).data,a=new Map;for(const[t,r]of Object.entries(o))a.set(t,r);return a}catch(s){throw console.error("❌ 获取所有数据失败:",s),s}}async deleteDailyData(s){try{const o=`hamster:${s}`;console.log(`⚠️ 删除功能暂未实现: ${s}`)}catch(o){throw console.error("❌ 删除运动数据失败:",o),o}}async getTotalCount(){try{return(await L("/hamster/total")).data}catch(s){throw console.error("❌ 获取总圈数失败:",s),s}}async getRecentData(s){try{const a=(await L(`/hamster/recent/${s}`)).data;console.log("🔍 从后端获取的最近数据:",a);const t=new Map;for(const[r,u]of Object.entries(a))t.set(r,u);return console.log("🔍 转换后的 Map 数据:",t),t}catch(o){throw console.error("❌ 获取最近数据失败:",o),o}}async getHalfHourlyData(s){try{return(await L(`/hamster/half_hourly/${s}`)).data||{}}catch(o){return console.error("❌ 获取30分钟数据失败:",o),{}}}async getLastHalfHourlyRecord(){try{return(await L("/hamster/last-half-hourly-record")).data}catch(s){return console.error("❌ 获取最后30分钟记录时间失败:",s),null}}async getLastUpdate(){try{return(await L("/hamster/last-update")).data}catch(s){return console.error("❌ 获取最后更新时间失败:",s),null}}async testConnection(){try{const s=await L("/test");return console.log("✅ 后端 API 连接测试成功:",s.message),!0}catch(s){return console.error("❌ 后端 API 连接测试失败:",s),!1}}async healthCheck(){try{return await L("/health")}catch(s){throw console.error("❌ 健康检查失败:",s),s}}}const Z=new Jt;function Xt(){const e=T([]),s=T(0),o=T(!1),a=async()=>{try{o.value=!0,console.log("正在从 Redis 加载历史数据...");const f=await Z.getRecentData(60);if(f.size===0){console.log("没有找到历史数据，跳过初始化");return}const i=[];for(const[b,S]of f){const p=R(b);i.push({date:b,count:S,hourlyData:Array.from({length:24},(g,l)=>({hour:l,count:0,timestamp:p.startOf("day").add(l,"hour").toISOString()}))})}i.sort((b,S)=>R(b.date).valueOf()-R(S.date).valueOf()),e.value=i;const _=R().format("YYYY-MM-DD"),D=e.value.find(b=>b.date===_);s.value=(D==null?void 0:D.count)||0,console.log(`✅ 从 Redis 加载了 ${i.length} 天的历史数据`),console.log("加载的数据详情:",i)}catch(f){console.error("❌ 从 Redis 加载历史数据失败:",f)}finally{o.value=!1}},t=async f=>{console.log("处理MQTT消息:",f);const i=R(),_=i.format("YYYY-MM-DD"),D=i.hour();let b=e.value.find(p=>p.date===_);b||(b={date:_,count:0,hourlyData:Array.from({length:24},(p,g)=>({hour:g,count:0,timestamp:i.startOf("day").add(g,"hour").toISOString()}))},e.value.push(b),console.log("创建新的今日数据记录"));const S=b.count;if(b.count+=f.count,s.value=b.count,console.log(`今日运动量更新: ${S} -> ${b.count}`),b.hourlyData){const p=b.hourlyData.find(g=>g.hour===D);p&&(p.count+=f.count,p.timestamp=i.toISOString(),console.log(`小时数据更新: 小时${D} -> ${p.count}`))}try{await Z.storeDailyData(_,b.count),console.log("✅ 数据已保存到 Redis")}catch(p){console.error("❌ 保存到 Redis 失败:",p)}e.value.length>60&&(e.value=e.value.slice(-60))},r=O(()=>{const f=R().format("YYYY-MM-DD"),i=e.value.find(l=>l.date===f);if(!(i!=null&&i.hourlyData))return[];const _=R(),D=_.subtract(12,"hour"),b=i.hourlyData.filter(l=>{const y=R().startOf("day").add(l.hour,"hour");return y.isAfter(D)&&y.isBefore(_)}),S=[];let p=null;const g=100;return b.forEach(l=>{if(l.count>=g){const y=l.hour.toString().padStart(2,"0")+":00";p?(p.end=y,p.totalCount+=l.count):p={start:y,end:y,totalCount:l.count}}else p&&(S.push(p),p=null)}),p&&S.push(p),S}),u=O(()=>{const f=R().subtract(30,"day");return e.value.filter(i=>R(i.date).isAfter(f)).map(i=>({date:i.date,count:i.count})).sort((i,_)=>R(i.date).valueOf()-R(_.date).valueOf())}),d=O(()=>{const f=R().startOf("month"),_=R().endOf("month").date(),D=[];for(let b=1;b<=_;b++){const S=f.date(b).format("YYYY-MM-DD"),p=e.value.find(g=>g.date===S);D.push({date:S,day:b,count:(p==null?void 0:p.count)||0,hasData:!!p})}return D});return{todayCount:s,activePeriods:r,monthlyTrendData:u,calendarData:d,processMessage:t,loadHistoricalData:a,isLoading:o,allData:e}}const Dt=Kt("hamster",()=>{const{todayCount:e,activePeriods:s,monthlyTrendData:o,calendarData:a,loadHistoricalData:t}=Xt(),r=T({connected:!1,error:void 0}),u=T(""),d=T([]);let f=null;const i=async()=>{try{const l=await Z.getLastUpdate();if(l){const y=new Date(l);u.value=y.toLocaleString("zh-CN")}else u.value="暂无更新"}catch(l){console.error("❌ 获取最后更新时间失败:",l),u.value="获取失败"}},_=async()=>{try{const l=await Z.testConnection();r.value={connected:l,error:l?void 0:"连接失败"}}catch(l){console.error("❌ Redis连接检查失败:",l),r.value={connected:!1,error:l instanceof Error?l.message:"未知错误"}}},D=async()=>{try{const l=new Date,y=l.toISOString().split("T")[0],x=await Z.getHalfHourlyData(y),Y=l.getHours(),N=l.getMinutes(),j=N>=30?"30":"00",E=`${Y.toString().padStart(2,"0")}:${j}`,A=[],w=new Date(l);w.setMinutes(j==="30"?30:0,0,0);for(let c=23;c>=0;c--){const v=new Date(w.getTime()-c*30*60*1e3),k=v.getHours().toString().padStart(2,"0"),C=v.getMinutes().toString().padStart(2,"0"),M=`${k}:${C}`,W=x[M]||0,V=new Date(v.getTime()-30*60*1e3),U=V.getHours().toString().padStart(2,"0"),P=V.getMinutes().toString().padStart(2,"0"),$t=`${U}:${P}`,St=x[$t]||0,Mt=Math.max(0,W-St);A.push({time:M,count:Mt})}d.value=A,console.log("✅ 过去12小时趋势数据加载完成（相对增加圈数）:",A),console.log("⏰ 当前时间:",`${Y.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`),console.log("📊 取整后时间:",E)}catch(l){console.error("❌ 获取过去12小时趋势数据失败:",l),d.value=[]}},b=()=>{f=window.setInterval(async()=>{console.log("🔄 定时轮询更新数据..."),await t(),await i(),await _()},6e4)},S=()=>{f&&(clearInterval(f),f=null)},p=async()=>{console.log("🚀 初始化前端应用..."),await _(),await t(),await D(),await i(),b(),console.log("✅ 前端应用初始化完成")},g=()=>{S()};return it(()=>{g()}),{todayCount:e,activePeriods:s,monthlyTrendData:o,calendarData:a,redisStatus:r,lastUpdateTime:u,twelveHourTrendData:d,initialize:p,cleanup:g,updateLastUpdateTime:i,checkRedisConnection:_,loadTwelveHourTrendData:D}}),Zt={class:"w-full h-80"},te=q({__name:"TrendChart",props:{data:{}},setup(e){pt.register(...Ft);const s=e,o=T(null);let a=null;const t=()=>{if(!o.value)return;a&&a.destroy();const r=o.value.getContext("2d");if(!r)return;const u=s.data.map(i=>{const _=new Date(i.date);return`${_.getMonth()+1}/${_.getDate()}`}),d=s.data.map(i=>i.count),f=r.createLinearGradient(0,0,0,400);f.addColorStop(0,"rgba(59, 130, 246, 0.8)"),f.addColorStop(1,"rgba(59, 130, 246, 0.1)"),a=new pt(r,{type:"line",data:{labels:u,datasets:[{label:"运动圈数",data:d,borderColor:"rgb(59, 130, 246)",backgroundColor:f,borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"rgb(59, 130, 246)",pointBorderColor:"rgb(255, 255, 255)",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",titleColor:"rgb(248, 250, 252)",bodyColor:"rgb(248, 250, 252)",borderColor:"rgba(100, 116, 139, 0.5)",borderWidth:1,callbacks:{label:i=>{var _;return`运动量: ${((_=i.parsed.y)==null?void 0:_.toLocaleString())??"0"} 圈`}}}},scales:{x:{grid:{color:"rgba(100, 116, 139, 0.2)"},ticks:{color:"rgb(148, 163, 184)"}},y:{grid:{color:"rgba(100, 116, 139, 0.2)"},ticks:{color:"rgb(148, 163, 184)",callback:i=>typeof i=="number"?i.toLocaleString():i}}},interaction:{intersect:!1,mode:"index"},animations:{tension:{duration:1e3,easing:"linear"}}}})};return et(()=>s.data,()=>{s.data.length>0&&t()},{deep:!0}),st(()=>{s.data.length>0&&t()}),it(()=>{a&&a.destroy()}),(r,u)=>(h(),m("div",Zt,[n("canvas",{ref_key:"chartCanvas",ref:o},null,512)]))}});const K=(e,s)=>{const o=e.__vccOpts||e;for(const[a,t]of s)o[a]=t;return o},ee=K(te,[["__scopeId","data-v-855b6621"]]),se={class:"w-full"},ae={class:"flex items-center justify-between mb-6"},oe={class:"flex items-center space-x-4"},ne={class:"flex items-center space-x-2"},re=["value"],le=["value"],ce={class:"grid grid-cols-7 gap-1 mb-3 border-b border-dark-700 pb-2"},ie={class:"grid grid-cols-7 gap-1"},de={class:"flex flex-col h-full"},ue={class:"text-center mb-1"},fe={class:"flex-1 flex items-center justify-center"},pe={key:0,class:"text-center"},ve={class:"text-xs font-semibold text-white mb-1"},he={key:0,class:"text-xs text-white"},me={key:1,class:"text-dark-500 text-xs"},ge=q({__name:"CalendarView",props:{data:{}},setup(e){const s=e,o=["日","一","二","三","四","五","六"],a=T(new Date().getFullYear()),t=T(new Date().getMonth()+1),r=O(()=>{const l=new Date().getFullYear();return Array.from({length:4},(y,x)=>l-2+x)}),u=O(()=>{const l=new Date(a.value,t.value,0).getDate(),x=new Date(a.value,t.value-1,1).getDay(),Y=Array(x).fill(null).map((j,E)=>({date:`blank-${E}`,day:0,count:0,hasData:!1,isBlank:!0})),N=Array.from({length:l},(j,E)=>{const A=E+1,w=`${a.value}-${t.value.toString().padStart(2,"0")}-${A.toString().padStart(2,"0")}`,c=s.data.find(v=>v.date===w);return{date:w,day:A,count:(c==null?void 0:c.count)||0,hasData:!!c,isBlank:!1}});return[...Y,...N]}),d=()=>{t.value===1?(t.value=12,a.value--):t.value--},f=()=>{t.value===12?(t.value=1,a.value++):t.value++},i=()=>{const l=new Date;a.value=l.getFullYear(),t.value=l.getMonth()+1},_=()=>{},D=l=>{const y=[];l.isBlank?y.push("bg-dark-800/20 border-dark-600/20"):l.count>0?y.push("bg-dark-700/60 border-dark-500 hover:bg-dark-600/60 cursor-pointer"):y.push("bg-dark-800/40 border-dark-700");const x=new Date;return x.getFullYear()===a.value&&x.getMonth()+1===t.value&&l.day===x.getDate()&&!l.isBlank&&y.push("ring-2 ring-primary-500/60 shadow-lg"),y.join(" ")},b=l=>{if(l.isBlank)return"text-dark-500";const y=new Date;return y.getFullYear()===a.value&&y.getMonth()+1===t.value&&l.day===y.getDate()?"text-primary-400 font-bold":l.count>0?"text-white":"text-dark-300"},S=l=>l>=1e3?"bg-green-500 shadow-lg shadow-green-500/25":l>=500?"bg-yellow-500 shadow-lg shadow-yellow-500/25":l>0?"bg-red-500 shadow-lg shadow-red-500/25":"bg-dark-600",p=l=>l>=1e3?"🏃":l>=500?"🐹":l>=100?"🏃":"😴",g=l=>l>=1e3?`${(l/1e3).toFixed(1)}k`:l.toString();return et(()=>s.data,()=>{},{deep:!0}),(l,y)=>(h(),m("div",se,[n("div",ae,[n("div",oe,[n("button",{onClick:d,class:"p-2 rounded-lg bg-dark-700 hover:bg-dark-600 transition-colors",title:"上个月"},[...y[2]||(y[2]=[n("span",{class:"text-white"},"◀",-1)])]),n("div",ne,[ut(n("select",{"onUpdate:modelValue":y[0]||(y[0]=x=>a.value=x),onChange:_,class:"bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"},[(h(!0),m(B,null,z(r.value,x=>(h(),m("option",{key:x,value:x},I(x)+"年 ",9,re))),128))],544),[[ft,a.value]]),ut(n("select",{"onUpdate:modelValue":y[1]||(y[1]=x=>t.value=x),onChange:_,class:"bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"},[(h(),m(B,null,z(12,x=>n("option",{key:x,value:x},I(x)+"月 ",9,le)),64))],544),[[ft,t.value]])]),n("button",{onClick:f,class:"p-2 rounded-lg bg-dark-700 hover:bg-dark-600 transition-colors",title:"下个月"},[...y[3]||(y[3]=[n("span",{class:"text-white"},"▶",-1)])])]),n("button",{onClick:i,class:"px-4 py-2 bg-primary-500 hover:bg-primary-600 rounded-lg text-white text-sm font-medium transition-colors"}," 今天 ")]),n("div",ce,[(h(),m(B,null,z(o,x=>n("div",{key:x,class:"text-center text-dark-400 text-sm font-medium py-2"},I(x),1)),64))]),n("div",ie,[(h(!0),m(B,null,z(u.value,x=>(h(),m("div",{key:x.date,class:J(["aspect-square p-1 rounded-lg border transition-all duration-200",D(x)])},[n("div",de,[n("div",ue,[n("span",{class:J(["text-sm font-medium",b(x)])},I(x.day),3)]),n("div",fe,[x.count>0?(h(),m("div",pe,[n("div",ve,I(g(x.count)),1),n("div",{class:J(["w-4 h-4 rounded-full mx-auto flex items-center justify-center",S(x.count)])},[x.count>0?(h(),m("span",he,I(p(x.count)),1)):H("",!0)],2)])):x.isBlank?H("",!0):(h(),m("div",me," - "))])])],2))),128))]),y[4]||(y[4]=at('<div class="flex justify-center items-center space-x-6 mt-6 pt-4 border-t border-dark-700" data-v-4441d33a><div class="flex items-center space-x-2" data-v-4441d33a><div class="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center" data-v-4441d33a><span class="text-xs" data-v-4441d33a>🏃</span></div><span class="text-dark-400 text-sm" data-v-4441d33a>活跃</span></div><div class="flex items-center space-x-2" data-v-4441d33a><div class="w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center" data-v-4441d33a><span class="text-xs" data-v-4441d33a>🐹</span></div><span class="text-dark-400 text-sm" data-v-4441d33a>中等</span></div><div class="flex items-center space-x-2" data-v-4441d33a><div class="w-4 h-4 bg-red-500 rounded-full flex items-center justify-center" data-v-4441d33a><span class="text-xs" data-v-4441d33a>😴</span></div><span class="text-dark-400 text-sm" data-v-4441d33a>较少</span></div><div class="flex items-center space-x-2" data-v-4441d33a><div class="w-4 h-4 bg-dark-600 rounded-full" data-v-4441d33a></div><span class="text-dark-400 text-sm" data-v-4441d33a>无数据</span></div></div>',1))]))}});const ye=K(ge,[["__scopeId","data-v-4441d33a"]]),_e=q({__name:"AnimatedNumber",props:{value:{},duration:{default:1e3},animate:{type:Boolean,default:!0}},setup(e){const s=e,o=T(0),a=(t,r,u)=>{const d=performance.now(),f=i=>{const _=i-d,D=Math.min(_/u,1),b=1-Math.pow(1-D,4);o.value=Math.floor(t+(r-t)*b),D<1&&requestAnimationFrame(f)};requestAnimationFrame(f)};return et(()=>s.value,(t,r=0)=>{s.animate?a(r,t,s.duration):o.value=t},{immediate:!0}),st(()=>{s.animate||(o.value=s.value)}),(t,r)=>(h(),m("span",{class:J(["animated-number",{"animate-count":e.animate}])},I(o.value.toLocaleString()),3))}});const be=K(_e,[["__scopeId","data-v-976421ef"]]),xe={key:0,class:"flex items-center justify-center h-full"},we={key:1,class:"chart-container"},ke={class:"chart-area"},De=["width","height"],Ce={class:"grid-lines"},$e=["x1","y1","x2","y2"],Se={class:"y-axis"},Me=["x","y"],Te=["d"],je=["cx","cy","onMouseenter"],Ae=["d"],He={class:"bg-dark-700 border border-dark-600 rounded-lg p-3 shadow-xl"},Ie={class:"text-white font-medium"},Pe={class:"text-primary-400 text-sm"},Re=q({__name:"TwelveHourTrendChart",props:{data:{}},emits:["refresh"],setup(e,{emit:s}){const o=e,a=s,t=T(),r=T(800),u=T(240),d={top:20,right:20,bottom:60,left:50},f=T({visible:!1,x:0,y:0,time:"",count:0}),i=T([]),_=T(null),D=T(""),b=()=>{const c=new Date,v=c.getHours().toString().padStart(2,"0"),k=c.getMinutes()>=30?"30":"00";return`${v}:${k}`},S=()=>{const c=b();c!==D.value&&(D.value=c,a("refresh"))},p=O(()=>o.data),g=O(()=>{const c=Math.max(...o.data.map(C=>C.count),100),v=[],k=Math.ceil(c/4);for(let C=0;C<=4;C++){const M=C*k;v.push({value:M,label:M===0?"0":`${M}`})}return v}),l=c=>{const k=(r.value-d.left-d.right)/(p.value.length-1);return d.left+c*k},y=c=>{const v=Math.max(...o.data.map(M=>M.count),100),C=(u.value-d.top-d.bottom)/v;return u.value-d.bottom-c*C},x=O(()=>p.value.length===0?"":p.value.map((v,k)=>{const C=l(k),M=y(v.count);return`${k===0?"M":"L"} ${C} ${M}`}).join(" ")),Y=O(()=>p.value.length===0?"":`${p.value.map((v,k)=>{const C=l(k),M=y(v.count);return`${k===0?"M":"L"} ${C} ${M}`}).join(" ")} L ${l(p.value.length-1)} ${u.value-d.bottom} L ${l(0)} ${u.value-d.bottom} Z`),N=(c,v)=>{const k=l(v),C=y(c.count);f.value={visible:!0,x:k+10,y:C-40,time:c.time,count:c.count}},j=()=>{f.value.visible=!1},E=()=>{if(o.data.length===0)return;i.value.length===0&&(i.value=o.data.map(v=>({...v,animatedCount:0})));let c=!0;i.value=i.value.map((v,k)=>{var W;const C=((W=o.data[k])==null?void 0:W.count)||0,M=v.animatedCount;if(M<C){const V=Math.ceil((C-M)*.1);v.animatedCount=Math.min(M+V,C),c=!1}return v}),c||(_.value=requestAnimationFrame(E))},A=()=>{if(t.value){const c=t.value.clientWidth,v=t.value.clientHeight;r.value=Math.max(c,300),u.value=Math.max(v,200),c<640?(d.left=40,d.right=20,d.bottom=50):(d.left=50,d.right=20,d.bottom=60)}};et(()=>o.data,c=>{c.length>0&&(i.value=c.map(v=>({...v,animatedCount:0})),_.value&&cancelAnimationFrame(_.value),_.value=requestAnimationFrame(E))},{deep:!0});let w=null;return st(()=>{A(),window.addEventListener("resize",A),t.value&&new ResizeObserver(A).observe(t.value),D.value=b(),w=window.setInterval(S,3e4),o.data.length>0&&E()}),it(()=>{window.removeEventListener("resize",A),_.value&&cancelAnimationFrame(_.value),w&&clearInterval(w)}),(c,v)=>(h(),m("div",{ref_key:"chartContainer",ref:t,class:"twelve-hour-trend-chart"},[e.data.length===0?(h(),m("div",xe,[...v[0]||(v[0]=[n("div",{class:"text-center"},[n("div",{class:"text-4xl mb-4"},"📈"),n("p",{class:"text-dark-400"},"暂无数据"),n("p",{class:"text-dark-500 text-sm mt-2"},"等待30分钟数据记录")],-1)])])):(h(),m("div",we,[n("div",ke,[(h(),m("svg",{width:r.value,height:u.value,class:"chart-svg"},[n("g",Ce,[(h(!0),m(B,null,z(g.value,(k,C)=>(h(),m("line",{key:`y-grid-${C}`,x1:d.left,y1:y(k.value),x2:r.value-d.right,y2:y(k.value),stroke:"#374151","stroke-width":"1",opacity:"0.3"},null,8,$e))),128))]),n("g",Se,[(h(!0),m(B,null,z(g.value,(k,C)=>(h(),m("text",{key:C,x:d.left-12,y:y(k.value),"text-anchor":"end",class:"text-sm text-dark-400","dominant-baseline":"middle"},I(k.label),9,Me))),128))]),n("path",{d:x.value,fill:"none",stroke:"url(#lineGradient)","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},null,8,Te),n("g",null,[(h(!0),m(B,null,z(p.value,(k,C)=>(h(),m("circle",{key:C,cx:l(C),cy:y(k.count),r:"4",fill:"url(#pointGradient)",stroke:"#1f2937","stroke-width":"2",class:"data-point",onMouseenter:M=>N(k,C),onMouseleave:j},null,40,je))),128))]),v[1]||(v[1]=at('<defs data-v-015c4c56><linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%" data-v-015c4c56><stop offset="0%" stop-color="#3b82f6" data-v-015c4c56></stop><stop offset="50%" stop-color="#8b5cf6" data-v-015c4c56></stop><stop offset="100%" stop-color="#ec4899" data-v-015c4c56></stop></linearGradient><radialGradient id="pointGradient" cx="50%" cy="50%" r="50%" data-v-015c4c56><stop offset="0%" stop-color="#60a5fa" data-v-015c4c56></stop><stop offset="100%" stop-color="#3b82f6" data-v-015c4c56></stop></radialGradient></defs>',1)),n("path",{d:Y.value,fill:"url(#areaGradient)",opacity:"0.3"},null,8,Ae),v[2]||(v[2]=n("defs",null,[n("linearGradient",{id:"areaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[n("stop",{offset:"0%","stop-color":"#3b82f6","stop-opacity":"0.6"}),n("stop",{offset:"100%","stop-color":"#3b82f6","stop-opacity":"0.1"})])],-1))],8,De))]),f.value.visible?(h(),m("div",{key:0,style:Et({left:`${f.value.x}px`,top:`${f.value.y}px`}),class:"tooltip"},[n("div",He,[n("div",Ie,I(f.value.time),1),n("div",Pe,I(f.value.count)+" 圈",1)])],4)):H("",!0)]))],512))}});const Oe=K(Re,[["__scopeId","data-v-015c4c56"]]),Le={class:"min-h-screen bg-dark-900 text-white select-none"},Ye={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Ee={class:"rounded-2xl p-8 mb-8 animate-gradient-palette glow-effect elegant-container elegant-border"},Ne={class:"text-center relative"},Fe={key:0,class:"absolute inset-0 pointer-events-none"},Be={key:0,class:"elegant-particle elegant-particle-fast",style:{top:"25%",left:"40%","animation-delay":"0.5s"}},ze={key:1,class:"elegant-particle elegant-particle-fast",style:{top:"35%",left:"60%","animation-delay":"1.5s"}},Ue={key:2,class:"elegant-particle elegant-particle-fast",style:{top:"45%",left:"35%","animation-delay":"2.5s"}},We={key:3,class:"elegant-particle elegant-particle-fast",style:{top:"55%",left:"65%","animation-delay":"3.5s"}},Ve={key:4,class:"elegant-particle elegant-particle-fast",style:{top:"65%",left:"45%","animation-delay":"4.5s"}},Ge={key:5,class:"elegant-particle elegant-particle-fast",style:{top:"75%",left:"55%","animation-delay":"5.5s"}},qe={key:6,class:"elegant-particle",style:{top:"5%",left:"50%","animation-delay":"10s"}},Ke={key:7,class:"elegant-particle",style:{top:"95%",left:"50%","animation-delay":"11s"}},Qe={key:8,class:"elegant-particle",style:{top:"50%",left:"5%","animation-delay":"12s"}},Je={key:9,class:"elegant-particle",style:{top:"50%",left:"95%","animation-delay":"13s"}},Xe={key:10,class:"elegant-particle elegant-particle-fast",style:{top:"20%",left:"50%","animation-delay":"6.5s"}},Ze={key:11,class:"elegant-particle elegant-particle-fast",style:{top:"80%",left:"50%","animation-delay":"7.5s"}},ts={class:"elegant-count"},es={class:"elegant-number"},ss={class:"mt-4 text-white/80 text-sm"},as={key:0},os={key:1},ns={key:2},rs={key:3},ls={key:4},cs={class:"bg-dark-800 rounded-xl p-6 border border-dark-700 mb-8"},is={class:"h-64"},ds={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},us={class:"bg-dark-800 rounded-xl p-6 border border-dark-700"},fs={class:"space-y-3"},ps={key:0,class:"text-dark-400 text-sm"},vs={class:"text-white font-medium"},hs={class:"text-primary-400 text-sm"},ms={class:"bg-dark-800 rounded-xl p-6 border border-dark-700"},gs={class:"space-y-3"},ys={class:"flex justify-between items-center"},_s={class:"flex justify-between items-center"},bs={class:"text-white text-sm"},xs={class:"flex justify-between items-center"},ws={class:"text-white"},ks={class:"bg-dark-800 rounded-xl p-6 border border-dark-700 mb-8"},Ds={class:"bg-dark-800 rounded-xl p-6 border border-dark-700"},Cs={class:"flex items-center justify-between mb-6"},$s={class:"text-dark-400 text-sm"},Ss=q({__name:"Dashboard",setup(e){const s=Dt(),o=T(""),a=T(""),{todayCount:t,activePeriods:r,monthlyTrendData:u,calendarData:d,redisStatus:f,lastUpdateTime:i,twelveHourTrendData:_}=Qt(s),D=()=>{const p=new Date;o.value=p.toLocaleTimeString("zh-CN"),a.value=p.toLocaleString("zh-CN")},b=O(()=>new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long"})),S=async()=>{console.log("🔄 图表检测到时间变化，自动刷新数据..."),await s.loadTwelveHourTrendData()};return st(()=>{D(),setInterval(D,1e3)}),(p,g)=>(h(),m("div",Le,[g[11]||(g[11]=at('<header class="bg-dark-800 border-b border-dark-700" data-v-e1829c6a><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" data-v-e1829c6a><div class="flex justify-center items-center py-4" data-v-e1829c6a><div class="flex items-center space-x-3" data-v-e1829c6a><div class="w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center" data-v-e1829c6a><span class="text-white font-bold text-sm" data-v-e1829c6a>🐹</span></div><h1 class="text-xl font-bold text-white" data-v-e1829c6a>Daily Ice Cream</h1></div></div></div></header>',1)),n("main",Ye,[n("div",Ee,[n("div",Ne,[$(t)>0?(h(),m("div",Fe,[g[0]||(g[0]=at('<div class="elegant-particle" style="top:10%;left:10%;animation-delay:0s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:20%;left:90%;animation-delay:1s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:30%;left:15%;animation-delay:2s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:40%;left:85%;animation-delay:3s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:50%;left:20%;animation-delay:4s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:60%;left:80%;animation-delay:5s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:70%;left:25%;animation-delay:6s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:80%;left:75%;animation-delay:7s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:90%;left:30%;animation-delay:8s;" data-v-e1829c6a></div><div class="elegant-particle" style="top:15%;left:70%;animation-delay:9s;" data-v-e1829c6a></div>',10)),$(t)>50?(h(),m("div",Be)):H("",!0),$(t)>50?(h(),m("div",ze)):H("",!0),$(t)>100?(h(),m("div",Ue)):H("",!0),$(t)>100?(h(),m("div",We)):H("",!0),$(t)>200?(h(),m("div",Ve)):H("",!0),$(t)>200?(h(),m("div",Ge)):H("",!0),$(t)>300?(h(),m("div",qe)):H("",!0),$(t)>300?(h(),m("div",Ke)):H("",!0),$(t)>500?(h(),m("div",Qe)):H("",!0),$(t)>500?(h(),m("div",Je)):H("",!0),$(t)>1e3?(h(),m("div",Xe)):H("",!0),$(t)>1e3?(h(),m("div",Ze)):H("",!0)])):H("",!0),g[2]||(g[2]=n("h2",{class:"text-2xl font-bold text-white mb-4 tracking-wide"}," Hi，我是雪糕，我今天跑了 ",-1)),n("div",ts,[n("span",es,[Q(be,{value:$(t),duration:2500},null,8,["value"])]),g[1]||(g[1]=n("span",{class:"elegant-unit ml-2"},"圈",-1))]),n("div",ss,[$(t)===0?(h(),m("span",as,"今天还没开始运动呢～")):$(t)<100?(h(),m("span",os,"加油，继续努力！")):$(t)<500?(h(),m("span",ns,"很棒的运动量！")):$(t)<1e3?(h(),m("span",rs,"运动达人！")):(h(),m("span",ls,"超级运动健将！"))])])]),n("div",cs,[g[3]||(g[3]=n("div",{class:"flex items-center justify-between mb-6"},[n("h3",{class:"text-xl font-semibold text-white"},"过去12小时运动趋势"),n("div",{class:"text-dark-400 text-sm"},"30分钟增量圈数")],-1)),n("div",is,[Q(Oe,{data:$(_),onRefresh:S},null,8,["data"])])]),n("div",ds,[n("div",us,[g[4]||(g[4]=n("div",{class:"flex items-center justify-between mb-4"},[n("h3",{class:"text-lg font-semibold text-white"},"活跃时间段"),n("div",{class:"w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center"},[n("span",{class:"text-green-400"},"⏰")])],-1)),n("div",fs,[$(r).length===0?(h(),m("div",ps," 暂无活跃数据 ")):H("",!0),(h(!0),m(B,null,z($(r),(l,y)=>(h(),m("div",{key:y,class:"flex items-center justify-between p-3 bg-dark-700/50 rounded-lg"},[n("div",vs,I(l.start)+" ~ "+I(l.end),1),n("div",hs,I(l.totalCount)+" 圈",1)]))),128))])]),n("div",ms,[g[8]||(g[8]=n("div",{class:"flex items-center justify-between mb-4"},[n("h3",{class:"text-lg font-semibold text-white"},"系统状态"),n("div",{class:"w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center"},[n("span",{class:"text-blue-400"},"📊")])],-1)),n("div",gs,[n("div",ys,[g[5]||(g[5]=n("span",{class:"text-dark-400"},"Redis数据库",-1)),n("span",{class:J(["font-medium",{"text-green-400":$(f).connected,"text-red-400":!$(f).connected&&$(f).error,"text-yellow-400":!$(f).connected&&!$(f).error}])},I($(f).connected?"正常":$(f).error?"错误":"连接中"),3)]),n("div",_s,[g[6]||(g[6]=n("span",{class:"text-dark-400"},"最后更新",-1)),n("span",bs,I($(i)||"暂无更新"),1)]),n("div",xs,[g[7]||(g[7]=n("span",{class:"text-dark-400"},"数据天数",-1)),n("span",ws,I($(u).length),1)])])])]),n("div",ks,[g[9]||(g[9]=n("div",{class:"flex items-center justify-between mb-6"},[n("h3",{class:"text-xl font-semibold text-white"},"过去30天运动趋势"),n("div",{class:"text-dark-400 text-sm"},"单位：圈数")],-1)),Q(ee,{data:$(u)},null,8,["data"])]),n("div",Ds,[n("div",Cs,[g[10]||(g[10]=n("h3",{class:"text-xl font-semibold text-white"},"本月运动日历",-1)),n("div",$s,I(b.value),1)]),Q(ye,{data:$(d)},null,8,["data"])])])]))}});const Ms=K(Ss,[["__scopeId","data-v-e1829c6a"]]),Ts={id:"app"},js=q({__name:"App",setup(e){const s=Dt();return st(async()=>{console.log("应用启动，从 Redis 加载历史数据..."),console.log("初始化MQTT连接..."),s.initialize()}),(o,a)=>(h(),m("div",Ts,[Q(Ms)]))}});const As=K(js,[["__scopeId","data-v-b02e0ada"]]);const Ct=Nt(As),Hs=zt();Ct.use(Hs);Ct.mount("#app");
